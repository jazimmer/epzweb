<!doctype html>
<html>
<head>
<script src="http://code.jquery.com/jquery-2.1.0.js"></script>
<script>

function writePage(html) {
   var w = window.open();
   $(w.document.body).html(html)
}

function processError(jqXHR,status,errorThrown,cgitb_error_message) {
var msg = 
"Either your page is corrupted or there has been a server error.\n" +
"Do you wish to see a debug error message?"

   if( confirm(msg) ) 
      if(cgitb_error_message) writePage(cgitb_error_message)
      else                    writePage(jqXHR.responseText)
}

function processSuccess(data,status,jqXHR) {
   function cgitbError(page) {
      var rgx = /A problem occurred in a Python script/
      if( rgx.exec(page) ) return true
      return false
   }

   if( cgitbError(data) ) {
      var page = '<!doctype html><html><body>'+data+'</body></html>'
      processError(undefined,undefined,undefined,page)
   } else {
      $('#empty').html(data)
   }
}

function test1() {
   $.ajax({
       url : "cgi.py",
       type : "POST",
       data : "",
       success : processSuccess,
       error : processError
   })
   return false
}
function test2() {
   $.ajax({
       url : "cgi2.py",
       type : "POST",
       data : "",
       success : processSuccess,
       error : processError
   })
   return false
}
function test3() {
   $.ajax({
       url : "notthere.py",
       type : "POST",
       data : "",
       success : processSuccess,
       error : processError
   })
   return false
}
</script>
</head>
<body>

<form  name="test"">
<div id='empty'></div>
<p>Produces Python error</p>
    <input type="button" id="submit_btn" value="Send 1" 
     onclick='javascript:test1()'/>
<p>Produces "hellow orld".</p>
    <input type="button" id="submit_btn" value="Send 2" 
     onclick='javascript:test2()'/>
<p>Produces "not found error"</p>
    <input type="button" id="submit_btn" value="Send 3" 
     onclick='javascript:test3()'/>
</form>
</body>
</html>


